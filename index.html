<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Health OS v5.1</title>
    <style>
        /* --- å…¨å±€å˜é‡ --- */
        :root {
            --phone-bg: #121212;
            --card-bg: rgba(30, 30, 30, 0.75);
            --text-main: #e0e0e0;
            --text-dim: #aaa;
            
            /* App Colors */
            --accent-sleep: #8b5cf6;
            --accent-poop: #f59e0b;
            --accent-period: #fb7185;
            --accent-settings: #64748b;
            
            --glass-border: rgba(255, 255, 255, 0.15);
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; font-family: var(--font-family); background: #000; display: flex; justify-content: center; height: 100vh; overflow: hidden; }

        /* --- æ‰‹æœºå®¹å™¨ --- */
        .phone-screen {
            width: 100%; max-width: 420px; height: 100%;
            background-color: var(--phone-bg);
            background-size: cover; background-position: center;
            position: relative; overflow: hidden;
            display: flex; flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        /* å£çº¸é®ç½© */
        .phone-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3); pointer-events: none; z-index: 0;
        }

        /* --- çŠ¶æ€æ  --- */
        .status-bar-top {
            height: 30px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; font-size: 12px; color: white; font-weight: 600;
            position: absolute; top: 0; width: 100%; z-index: 100;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .battery-icon {
            width: 22px; height: 10px; border: 1px solid white; border-radius: 2px;
            position: relative; display: inline-block; margin-left: 5px;
        }
        .battery-icon::after {
            content: ''; position: absolute; right: -2px; top: 2px; width: 2px; height: 4px; background: white;
        }
        .battery-level { height: 100%; width: 80%; background: white; }

        /* --- å±å¹•åˆ‡æ¢ç³»ç»Ÿ --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            transform: scale(0.95); opacity: 0; pointer-events: none;
            transition: all 0.25s cubic-bezier(0.4, 0.0, 0.2, 1);
            z-index: 10; overflow-y: auto;
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
        }
        /* ä¸»å±å¹•é»˜è®¤æ¿€æ´» */
        .screen.active { transform: scale(1); opacity: 1; pointer-events: auto; z-index: 20; }
        .screen.home { transform: scale(1); opacity: 1; pointer-events: auto; z-index: 1; background: transparent; backdrop-filter: none; }

        /* --- App å¯¼èˆªæ  --- */
        .app-nav {
            height: 50px; display: flex; align-items: center; padding: 0 15px; margin-top: 30px; /* é¿å¼€çŠ¶æ€æ  */
            border-bottom: 1px solid var(--glass-border);
        }
        .back-btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 10px; }
        .page-title { font-size: 17px; font-weight: 600; color: white; flex: 1; text-align: center; margin-right: 44px; }

        /* --- å†…å®¹åŒº --- */
        .content { padding: 20px; padding-bottom: 100px; position: relative; z-index: 2; }
        .card {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 24px; padding: 20px; margin-bottom: 16px;
            backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .btn {
            width: 100%; padding: 15px; border-radius: 16px; border: none;
            font-size: 16px; font-weight: 600; color: white; cursor: pointer;
            margin-top: 10px; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.97); }

        /* --- Home Screen --- */
        .home-clock-widget { margin-top: 80px; text-align: center; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .home-time-text { font-size: 5rem; font-weight: 200; line-height: 1; letter-spacing: -2px; }
        .home-date-text { font-size: 1.2rem; margin-top: 10px; font-weight: 500; opacity: 0.9; }
        
        .app-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; padding: 40px 15px;
            position: absolute; bottom: 40px; width: 100%;
        }
        .app-icon { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: transform 0.2s; }
        .app-icon:active { transform: scale(0.9); filter: brightness(0.8); }
        .icon-box {
            width: 62px; height: 62px; border-radius: 16px; display: flex; justify-content: center; align-items: center; font-size: 28px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
        }
        .icon-sleep { background: linear-gradient(135deg, #7c3aed, #a78bfa); }
        .icon-poop { background: linear-gradient(135deg, #d97706, #fbbf24); }
        .icon-period { background: linear-gradient(135deg, #be123c, #fda4af); }
        .icon-settings { background: linear-gradient(135deg, #334155, #64748b); }
        .icon-label { color: white; font-size: 11px; text-shadow: 0 1px 3px rgba(0,0,0,0.8); font-weight: 500; }

        /* --- Settings Item --- */
        .settings-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white; font-size: 15px;
        }
        .settings-item:last-child { border-bottom: none; }

        /* --- Components (Calendar, etc) --- */
        .calendar-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; color: white; font-weight: 600; }
        .nav-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 28px; height: 28px; border-radius: 8px; cursor: pointer; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
        .cal-cell {
            aspect-ratio: 1; display: flex; justify-content: center; align-items: center;
            border-radius: 10px; font-size: 13px; color: #666; position: relative;
            background: rgba(255,255,255,0.02);
        }
        .cal-cell.today { border: 1.5px solid white; color: white; font-weight: bold; }
        
        /* Markers */
        .marker-sleep-gold { background: rgba(251, 191, 36, 0.2); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); }
        .marker-sleep-silver { background: rgba(148, 163, 184, 0.2); color: #94a3b8; }
        .poop-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent-poop); position: absolute; bottom: 5px; }
        .bg-period { background: var(--accent-period); color: white; }
        .bg-period-predict { border: 1px dashed var(--accent-period); color: var(--accent-period); }
        .bg-ovulation { background: rgba(167, 139, 250, 0.25); color: #c4b5fd; }
        
        /* Toast */
        .toast {
            position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(20, 20, 20, 0.9); color: white; padding: 12px 24px; border-radius: 30px;
            font-size: 14px; opacity: 0; transition: opacity 0.3s; z-index: 2000; pointer-events: none;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
        }
        .toast.show { opacity: 1; }

        /* Poop Selector */
        .poop-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .poop-opt { flex: 1; background: rgba(0,0,0,0.2); text-align: center; padding: 12px 0; border-radius: 16px; font-size: 24px; opacity: 0.5; cursor: pointer; transition: 0.2s; }
        .poop-opt.selected { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--accent-poop); opacity: 1; transform: scale(1.05); }

        /* Period Ring */
        .cycle-ring {
            width: 180px; height: 180px; border-radius: 50%; margin: 0 auto 20px;
            border: 8px solid rgba(251, 113, 133, 0.1);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .cycle-ring.active { border-color: var(--accent-period); box-shadow: 0 0 30px rgba(251, 113, 133, 0.2); }

        /* File Input Label */
        .file-btn {
            background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px;
            font-size: 13px; cursor: pointer; display: inline-block; color: white;
        }
    </style>
</head>
<body>

<div class="phone-screen" id="phone-bg">
    <div class="phone-overlay"></div>

    <div class="status-bar-top">
        <span id="sb-time">12:00</span>
        <div style="display:flex; align-items:center;">
            <span>5G</span>
            <div class="battery-icon"><div class="battery-level"></div></div>
        </div>
    </div>

    <div id="screen-home" class="screen home active">
        <div class="home-clock-widget">
            <div class="home-time-text" id="home-time">--:--</div>
            <div class="home-date-text" id="home-date">--æœˆ--æ—¥</div>
        </div>
        <div class="app-grid">
            <div class="app-icon" onclick="App.open('sleep')"><div class="icon-box icon-sleep">ğŸŒ™</div><span class="icon-label">æ—©ç¡</span></div>
            <div class="app-icon" onclick="App.open('poop')"><div class="icon-box icon-poop">ğŸ’©</div><span class="icon-label">ä¾¿ä¾¿</span></div>
            <div class="app-icon" onclick="App.open('period')"><div class="icon-box icon-period">ğŸ©¸</div><span class="icon-label">ç»æœŸ</span></div>
            <div class="app-icon" onclick="App.open('settings')"><div class="icon-box icon-settings">âš™ï¸</div><span class="icon-label">è®¾ç½®</span></div>
        </div>
    </div>

    <div id="screen-sleep" class="screen">
        <div class="app-nav"><button class="back-btn" onclick="App.home()">â€¹</button><div class="page-title">æ—©ç¡æ‰“å¡</div></div>
        <div class="content">
            <div class="card" style="text-align:center;">
                <div style="font-size:2.5rem; font-weight:bold; color:white;" id="sleep-big-time">00:00</div>
                <div style="color:var(--text-dim); margin-top:5px;">ç›®æ ‡: <input type="time" id="sleep-target" value="23:00" onchange="SleepApp.saveSettings()" style="background:none;border:none;color:var(--accent-sleep);font-family:inherit;"></div>
            </div>
            <button class="btn" style="background:var(--accent-sleep);" onclick="SleepApp.checkIn()">ğŸ˜´ æˆ‘è¦ç¡äº†</button>
            <div class="card">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="App.changeMonth('sleep', -1)">â€¹</button><span id="sleep-cal-title">--</span><button class="nav-btn" onclick="App.changeMonth('sleep', 1)">â€º</button>
                </div>
                <div class="cal-grid" id="sleep-cal-grid"></div>
            </div>
        </div>
    </div>

    <div id="screen-poop" class="screen">
        <div class="app-nav"><button class="back-btn" onclick="App.home()">â€¹</button><div class="page-title">ä¾¿ä¾¿æ—¥è®°</div></div>
        <div class="content">
            <div class="card">
                <div style="text-align:center; font-size:2rem; font-weight:bold; color:white;" id="poop-count">0</div>
                <div style="text-align:center; font-size:12px; color:var(--accent-poop);" id="poop-last">ä¸Šæ¬¡: æ— è®°å½•</div>
            </div>
            <div class="card">
                <div class="poop-selector">
                    <div class="poop-opt" data-v="1" onclick="PoopApp.select(1)">ğŸª¨</div>
                    <div class="poop-opt selected" data-v="2" onclick="PoopApp.select(2)">ğŸŒ</div>
                    <div class="poop-opt" data-v="3" onclick="PoopApp.select(3)">ğŸ¦</div>
                    <div class="poop-opt" data-v="4" onclick="PoopApp.select(4)">ğŸŒŠ</div>
                </div>
                <button class="btn" style="background:var(--accent-poop);" onclick="PoopApp.checkIn()">ğŸ§» è®°å½•</button>
            </div>
            <div class="card">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="App.changeMonth('poop', -1)">â€¹</button><span id="poop-cal-title">--</span><button class="nav-btn" onclick="App.changeMonth('poop', 1)">â€º</button>
                </div>
                <div class="cal-grid" id="poop-cal-grid"></div>
            </div>
        </div>
    </div>

    <div id="screen-period" class="screen">
        <div class="app-nav"><button class="back-btn" onclick="App.home()">â€¹</button><div class="page-title">ç»æœŸåŠ©æ‰‹</div></div>
        <div class="content">
            <div class="cycle-ring" id="period-ring">
                <div style="font-size:2.5rem; font-weight:bold; color:white;" id="period-days-text">--</div>
                <div style="font-size:0.9rem; color:var(--accent-period);" id="period-status-text">ç­‰å¾…æ•°æ®</div>
            </div>
            <div class="card">
                <button class="btn" style="background:var(--accent-period);" id="period-btn" onclick="PeriodApp.toggleToday()">å¤§å§¨å¦ˆæ¥äº†</button>
            </div>
            <div class="card">
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="App.changeMonth('period', -1)">â€¹</button><span id="period-cal-title">--</span><button class="nav-btn" onclick="App.changeMonth('period', 1)">â€º</button>
                </div>
                <div class="cal-grid" id="period-cal-grid"></div>
            </div>
        </div>
    </div>

    <div id="screen-settings" class="screen">
        <div class="app-nav"><button class="back-btn" onclick="App.home()">â€¹</button><div class="page-title">ç³»ç»Ÿè®¾ç½®</div></div>
        <div class="content">
            <div class="card">
                <h3 style="color:white; margin:0 0 20px 0;">å¤–è§‚</h3>
                <div class="settings-item">
                    <span>æ›´æ¢å£çº¸</span>
                    <label class="file-btn">é€‰æ‹©å›¾ç‰‡<input type="file" accept="image/*" style="display:none;" onchange="SettingsApp.uploadWallpaper(this)"></label>
                </div>
                <div class="settings-item">
                    <span>é‡ç½®å£çº¸</span>
                    <span style="color:#fb7185; cursor:pointer;" onclick="SettingsApp.resetWallpaper()">æ¢å¤é»˜è®¤</span>
                </div>
            </div>

            <div class="card">
                <h3 style="color:white; margin:0 0 20px 0;">æ•°æ®ç®¡ç†</h3>
                <div style="font-size:12px; color:#888; margin-bottom:15px;">è¯·å®šæœŸå¤‡ä»½æ•°æ®ï¼Œä»¥å…ä¸¢å¤±ã€‚</div>
                
                <button class="btn" style="background: #334155; margin-bottom:10px;" onclick="DataManager.export()">ğŸ“¥ å¯¼å‡ºå¤‡ä»½æ•°æ® (JSON)</button>
                
                <label class="btn" style="background: #334155; display:block; text-align:center;">
                    ğŸ“¤ å¯¼å…¥å¤‡ä»½æ•°æ®
                    <input type="file" accept=".json" style="display:none;" onchange="DataManager.import(this)">
                </label>
                
                <div class="settings-item" onclick="SettingsApp.clearData()" style="margin-top:20px; color:#fb7185; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px;">
                    <span>æ¸…é™¤æ‰€æœ‰æ•°æ® (æ…ç‚¹)</span><span>â€º</span>
                </div>
            </div>
            
            <div style="text-align:center; color:#555; font-size:12px; margin-top:20px;">Health OS v5.1</div>
        </div>
    </div>

    <div id="toast" class="toast">æç¤ºä¿¡æ¯</div>
</div>

<script>
    /* --- ç³»ç»Ÿæ ¸å¿ƒ --- */
    const DB = {
        get: (k, d) => JSON.parse(localStorage.getItem(k)||JSON.stringify(d)),
        set: (k, v) => localStorage.setItem(k, JSON.stringify(v)),
        today: () => new Date().toISOString().split('T')[0],
        timeStr: () => new Date().toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'})
    };

    const UI = {
        toast: (msg) => {
            const t = document.getElementById('toast'); t.innerText = msg; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        },
        renderCal: (elId, titleId, date, cb) => {
            const year = date.getFullYear(), month = date.getMonth();
            document.getElementById(titleId).innerText = `${year}å¹´ ${month+1}æœˆ`;
            const el = document.getElementById(elId); el.innerHTML = '';
            const firstDay = new Date(year, month, 1).getDay();
            const days = new Date(year, month + 1, 0).getDate();
            for(let i=0; i<firstDay; i++) el.appendChild(document.createElement('div'));
            for(let d=1; d<=days; d++) {
                const ds = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const cell = document.createElement('div'); cell.className = 'cal-cell'; cell.innerText = d;
                if(ds === DB.today()) cell.classList.add('today');
                cb(cell, ds); el.appendChild(cell);
            }
        }
    };

    /* --- æ•°æ®ç®¡ç†å™¨ --- */
    const DataManager = {
        keys: ['sleep_data', 'sleep_target', 'poop_data', 'period_dates', 'period_settings', 'health_os_wallpaper'],
        export: () => {
            const backup = {};
            DataManager.keys.forEach(key => {
                const val = localStorage.getItem(key);
                if(val) backup[key] = val;
            });
            const blob = new Blob([JSON.stringify(backup)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = `health_os_backup_${DB.today()}.json`;
            a.click();
            UI.toast("å¤‡ä»½å·²ä¸‹è½½ âœ…");
        },
        import: (input) => {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
                    UI.toast("æ¢å¤æˆåŠŸï¼Œé‡å¯ä¸­...");
                    setTimeout(() => location.reload(), 1500);
                } catch(err) {
                    alert("æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼");
                }
            };
            reader.readAsText(file);
        }
    };

    /* --- App é€»è¾‘ --- */
    const App = {
        dates: { sleep: new Date(), poop: new Date(), period: new Date() },
        open: (id) => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${id}`).classList.add('active');
            if(id==='sleep') SleepApp.render();
            if(id==='poop') PoopApp.render();
            if(id==='period') PeriodApp.render();
            if(id==='settings') SettingsApp.init();
        },
        home: () => {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-home').classList.add('active');
        },
        changeMonth: (key, offset) => {
            App.dates[key].setMonth(App.dates[key].getMonth() + offset);
            if(key==='sleep') SleepApp.render();
            if(key==='poop') PoopApp.render();
            if(key==='period') PeriodApp.render();
        },
        init: () => {
            const wp = localStorage.getItem('health_os_wallpaper');
            if(wp) document.getElementById('phone-bg').style.backgroundImage = `url(${wp})`;
        }
    };

    /* --- Sleep App --- */
    const SleepApp = {
        render: () => {
            const data = DB.get('sleep_data', []);
            const target = DB.get('sleep_target', '23:00');
            document.getElementById('sleep-target').value = target;
            document.getElementById('sleep-big-time').innerText = DB.timeStr();
            UI.renderCal('sleep-cal-grid', 'sleep-cal-title', App.dates.sleep, (cell, ds) => {
                const rec = data.find(r => r.date === ds);
                if(rec) cell.classList.add(rec.time <= target ? 'marker-sleep-gold' : 'marker-sleep-silver');
            });
        },
        checkIn: () => {
            const data = DB.get('sleep_data', []);
            if(data.some(r=>r.date===DB.today())) return UI.toast('ä»Šæ—¥å·²æ‰“å¡');
            data.unshift({date:DB.today(), time:DB.timeStr()});
            DB.set('sleep_data', data); UI.toast('æ™šå®‰ ğŸ’¤'); SleepApp.render();
        },
        saveSettings: () => {
            DB.set('sleep_target', document.getElementById('sleep-target').value);
            SleepApp.render();
        }
    };

    /* --- Poop App --- */
    const PoopApp = {
        type: 2,
        select: (v) => {
            PoopApp.type = v;
            document.querySelectorAll('.poop-opt').forEach(e=>e.classList.remove('selected'));
            document.querySelector(`.poop-opt[data-v="${v}"]`).classList.add('selected');
        },
        render: () => {
            const data = DB.get('poop_data', []);
            const t = DB.today();
            document.getElementById('poop-count').innerText = data.filter(r=>r.date===t).length;
            if(data.length>0) {
                const last = data[0];
                const diff = Math.floor((Date.now() - last.ts)/60000);
                document.getElementById('poop-last').innerText = `ä¸Šæ¬¡: ${diff<60?diff+'åˆ†é’Ÿå‰':last.date}`;
            }
            UI.renderCal('poop-cal-grid', 'poop-cal-title', App.dates.poop, (cell, ds) => {
                if(data.some(r=>r.date===ds)) {
                    const dot = document.createElement('div'); dot.className='poop-dot'; cell.appendChild(dot);
                }
            });
        },
        checkIn: () => {
            const data = DB.get('poop_data', []);
            data.unshift({date:DB.today(), ts:Date.now(), type:PoopApp.type});
            DB.set('poop_data', data); UI.toast('è®°å½•æˆåŠŸ ğŸ§»'); PoopApp.render();
        }
    };

    /* --- Period App --- */
    const PeriodApp = {
        render: () => {
            const data = DB.get('period_dates', []);
            const settings = DB.get('period_settings', {cycle:28, duration:5});
            
            let nextStart = null, ovulation = null, predictDates = [];
            if(data.length>0) {
                const sorted = [...data].sort();
                let last = new Date(sorted[sorted.length-1]);
                while(true) {
                    let prev = new Date(last); prev.setDate(prev.getDate()-1);
                    if(data.includes(prev.toISOString().split('T')[0])) last = prev; else break;
                }
                nextStart = new Date(last); nextStart.setDate(nextStart.getDate()+parseInt(settings.cycle));
                let ov = new Date(nextStart); ov.setDate(ov.getDate()-14);
                ovulation = ov.toISOString().split('T')[0];
                for(let i=0; i<settings.duration; i++){
                    let d = new Date(nextStart); d.setDate(d.getDate()+i);
                    predictDates.push(d.toISOString().split('T')[0]);
                }
            }

            const isPeriod = data.includes(DB.today());
            document.getElementById('period-btn').innerText = isPeriod ? "ç»æœŸç»“æŸ" : "å¤§å§¨å¦ˆæ¥äº†";
            document.getElementById('period-days-text').innerText = isPeriod ? "ç»æœŸä¸­" : (nextStart ? Math.ceil((nextStart-new Date())/86400000) : "--");
            document.getElementById('period-status-text').innerText = isPeriod ? "æ³¨æ„ä¿æš–" : (nextStart ? "å¤©åå¤§å§¨å¦ˆ" : "ç­‰å¾…æ•°æ®");
            if(isPeriod) document.getElementById('period-ring').classList.add('active'); 
            else document.getElementById('period-ring').classList.remove('active');

            UI.renderCal('period-cal-grid', 'period-cal-title', App.dates.period, (cell, ds) => {
                cell.onclick = () => PeriodApp.toggle(ds);
                if(data.includes(ds)) cell.classList.add('bg-period');
                else if(predictDates.includes(ds)) cell.classList.add('bg-period-predict');
                else if(ds === ovulation) cell.classList.add('bg-ovulation');
            });
        },
        toggle: (ds) => {
            let data = DB.get('period_dates', []);
            if(data.includes(ds)) data = data.filter(d=>d!==ds); else data.push(ds);
            DB.set('period_dates', data); PeriodApp.render();
        },
        toggleToday: () => PeriodApp.toggle(DB.today())
    };

    /* --- Settings App --- */
    const SettingsApp = {
        init: () => {},
        uploadWallpaper: (input) => {
            const file = input.files[0];
            if(!file) return;
            const r = new FileReader();
            r.onload = (e) => {
                try {
                    localStorage.setItem('health_os_wallpaper', e.target.result);
                    document.getElementById('phone-bg').style.backgroundImage = `url(${e.target.result})`;
                    UI.toast('å£çº¸è®¾ç½®æˆåŠŸ âœ¨');
                } catch(err) { alert("å›¾ç‰‡å¤ªå¤§å•¦ï¼Œæ¢å¼ å°ç‚¹çš„å§"); }
            };
            r.readAsDataURL(file);
        },
        resetWallpaper: () => {
            localStorage.removeItem('health_os_wallpaper');
            document.getElementById('phone-bg').style.backgroundImage = '';
            UI.toast('æ¢å¤é»˜è®¤å£çº¸');
        },
        clearData: () => {
            if(confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿæ— æ³•æ¢å¤ã€‚')) {
                localStorage.clear(); location.reload();
            }
        }
    };

    /* --- Init --- */
    setInterval(() => {
        const now = new Date();
        const t = now.toLocaleTimeString('zh-CN', {hour:'2-digit', minute:'2-digit'});
        const d = now.toLocaleDateString('zh-CN', {month:'long', day:'numeric', weekday:'long'});
        ['home-time','sb-time'].forEach(id => document.getElementById(id).innerText = t);
        document.getElementById('home-date').innerText = d;
    }, 1000);

    App.init();
</script>
</body>
</html>
